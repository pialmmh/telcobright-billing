drop procedure OutIntCase1;		
DELIMITER //		
CREATE PROCEDURE OutIntCase1(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),CountryCode		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCase2;		
DELIMITER //		
CREATE PROCEDURE OutIntCase2(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),CountryCode,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase3;		
DELIMITER //		
CREATE PROCEDURE OutIntCase3(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`),CountryCode,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase4;		
DELIMITER //		
CREATE PROCEDURE OutIntCase4(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),CountryCode,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase5;		
DELIMITER //		
CREATE PROCEDURE OutIntCase5(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase6;		
DELIMITER //		
CREATE PROCEDURE OutIntCase6(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase7;		
DELIMITER //		
CREATE PROCEDURE OutIntCase7(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by date(`Date`),CountryCode,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase8;		
DELIMITER //		
CREATE PROCEDURE OutIntCase8(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_igwid  		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase9;		
DELIMITER //		
CREATE PROCEDURE OutIntCase9(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase10;		
DELIMITER //		
CREATE PROCEDURE OutIntCase10(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),CountryCode		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCase11;		
DELIMITER //		
CREATE PROCEDURE OutIntCase11(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),CountryCode,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase12;		
DELIMITER //		
CREATE PROCEDURE OutIntCase12(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`),CountryCode,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase13;		
DELIMITER //		
CREATE PROCEDURE OutIntCase13(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),CountryCode,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase14;		
DELIMITER //		
CREATE PROCEDURE OutIntCase14(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase15;		
DELIMITER //		
CREATE PROCEDURE OutIntCase15(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase16;		
DELIMITER //		
CREATE PROCEDURE OutIntCase16(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by date(`Date`),CountryCode,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase17;		
DELIMITER //		
CREATE PROCEDURE OutIntCase17(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_igwid  		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase18;		
DELIMITER //		
CREATE PROCEDURE OutIntCase18(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCase19;		
DELIMITER //		
CREATE PROCEDURE OutIntCase19(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),MatchedPrefixY		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase20;		
DELIMITER //		
CREATE PROCEDURE OutIntCase20(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase21;		
DELIMITER //		
CREATE PROCEDURE OutIntCase21(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase22;		
DELIMITER //		
CREATE PROCEDURE OutIntCase22(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),MatchedPrefixY,customerid		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCase23;		
DELIMITER //		
CREATE PROCEDURE OutIntCase23(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase24;		
DELIMITER //		
CREATE PROCEDURE OutIntCase24(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase25;		
DELIMITER //		
CREATE PROCEDURE OutIntCase25(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by date(`Date`),MatchedPrefixY,customerid		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCase26;		
DELIMITER //		
CREATE PROCEDURE OutIntCase26(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId    		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase27;		
DELIMITER //		
CREATE PROCEDURE OutIntCase27(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCase28;		
DELIMITER //		
CREATE PROCEDURE OutIntCase28(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase29;		
DELIMITER //		
CREATE PROCEDURE OutIntCase29(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase30;		
DELIMITER //		
CREATE PROCEDURE OutIntCase30(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase31;		
DELIMITER //		
CREATE PROCEDURE OutIntCase31(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCase32;		
DELIMITER //		
CREATE PROCEDURE OutIntCase32(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase33;		
DELIMITER //		
CREATE PROCEDURE OutIntCase33(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase34;		
DELIMITER //		
CREATE PROCEDURE OutIntCase34(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCase35;		
DELIMITER //		
CREATE PROCEDURE OutIntCase35(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCase36;		
DELIMITER //		
CREATE PROCEDURE OutIntCase36(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntOneCountryCase19;		
DELIMITER //		
CREATE PROCEDURE OutIntOneCountryCase19(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),MatchedPrefixY		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntOneCountryCase20;		
DELIMITER //		
CREATE PROCEDURE OutIntOneCountryCase20(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntOneCountryCase21;		
DELIMITER //		
CREATE PROCEDURE OutIntOneCountryCase21(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntOneCountryCase22;		
DELIMITER //		
CREATE PROCEDURE OutIntOneCountryCase22(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),MatchedPrefixY,customerid		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntOneCountryCase23;		
DELIMITER //		
CREATE PROCEDURE OutIntOneCountryCase23(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntOneCountryCase24;		
DELIMITER //		
CREATE PROCEDURE OutIntOneCountryCase24(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntOneCountryCase25;		
DELIMITER //		
CREATE PROCEDURE OutIntOneCountryCase25(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by date(`Date`),MatchedPrefixY,customerid		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntOneCountryCase26;		
DELIMITER //		
CREATE PROCEDURE OutIntOneCountryCase26(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId    		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntOneCountryCase27;		
DELIMITER //		
CREATE PROCEDURE OutIntOneCountryCase27(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntOneCountryCase28;		
DELIMITER //		
CREATE PROCEDURE OutIntOneCountryCase28(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntOneCountryCase29;		
DELIMITER //		
CREATE PROCEDURE OutIntOneCountryCase29(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntOneCountryCase30;		
DELIMITER //		
CREATE PROCEDURE OutIntOneCountryCase30(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntOneCountryCase31;		
DELIMITER //		
CREATE PROCEDURE OutIntOneCountryCase31(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntOneCountryCase32;		
DELIMITER //		
CREATE PROCEDURE OutIntOneCountryCase32(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntOneCountryCase33;		
DELIMITER //		
CREATE PROCEDURE OutIntOneCountryCase33(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntOneCountryCase34;		
DELIMITER //		
CREATE PROCEDURE OutIntOneCountryCase34(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntOneCountryCase35;		
DELIMITER //		
CREATE PROCEDURE OutIntOneCountryCase35(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntOneCountryCase36;		
DELIMITER //		
CREATE PROCEDURE OutIntOneCountryCase36(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntOneCountryCase19;		
DELIMITER //		
CREATE PROCEDURE SummaryOutIntOneCountryCase19(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by MatchedPrefixY		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
where cx.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntOneCountryCase20;		
DELIMITER //		
CREATE PROCEDURE SummaryOutIntOneCountryCase20(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by MatchedPrefixY,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
where cx.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntOneCountryCase21;		
DELIMITER //		
CREATE PROCEDURE SummaryOutIntOneCountryCase21(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by MatchedPrefixY,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
where cx.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntOneCountryCase22;		
DELIMITER //		
CREATE PROCEDURE SummaryOutIntOneCountryCase22(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by MatchedPrefixY,customerid		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
where cx.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntOneCountryCase23;		
DELIMITER //		
CREATE PROCEDURE SummaryOutIntOneCountryCase23(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
where cx.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntOneCountryCase24;		
DELIMITER //		
CREATE PROCEDURE SummaryOutIntOneCountryCase24(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId  		
  group by MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
where cx.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntOneCountryCase25;		
DELIMITER //		
CREATE PROCEDURE SummaryOutIntOneCountryCase25(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by MatchedPrefixY,customerid		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
where cx.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntOneCountryCase26;		
DELIMITER //		
CREATE PROCEDURE SummaryOutIntOneCountryCase26(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId    		
  group by MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
where cx.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntOneCountryCase27;		
DELIMITER //		
CREATE PROCEDURE SummaryOutIntOneCountryCase27(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
where cx.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntOneCountryCase28;		
DELIMITER //		
CREATE PROCEDURE SummaryOutIntOneCountryCase28(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
where cx.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntOneCountryCase29;		
DELIMITER //		
CREATE PROCEDURE SummaryOutIntOneCountryCase29(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by MatchedPrefixY,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
where cx.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntOneCountryCase30;		
DELIMITER //		
CREATE PROCEDURE SummaryOutIntOneCountryCase30(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
where cx.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntOneCountryCase31;		
DELIMITER //		
CREATE PROCEDURE SummaryOutIntOneCountryCase31(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
where cx.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntOneCountryCase32;		
DELIMITER //		
CREATE PROCEDURE SummaryOutIntOneCountryCase32(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
where cx.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntOneCountryCase33;		
DELIMITER //		
CREATE PROCEDURE SummaryOutIntOneCountryCase33(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
where cx.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntOneCountryCase34;		
DELIMITER //		
CREATE PROCEDURE SummaryOutIntOneCountryCase34(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
where cx.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntOneCountryCase35;		
DELIMITER //		
CREATE PROCEDURE SummaryOutIntOneCountryCase35(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
where cx.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntOneCountryCase36;		
DELIMITER //		
CREATE PROCEDURE SummaryOutIntOneCountryCase36(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
where cx.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
		
drop procedure SummaryOutIntCase1;		
DELIMITER //		
create procedure SummaryOutIntCase1(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by CountryCode		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCase2;		
DELIMITER //		
create procedure SummaryOutIntCase2(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by CountryCode,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase3;		
DELIMITER //		
create procedure SummaryOutIntCase3(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by CountryCode,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase4;		
DELIMITER //		
create procedure SummaryOutIntCase4(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by CountryCode,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase5;		
DELIMITER //		
create procedure SummaryOutIntCase5(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by CountryCode,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase6;		
DELIMITER //		
create procedure SummaryOutIntCase6(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by CountryCode,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase7;		
DELIMITER //		
create procedure SummaryOutIntCase7(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by CountryCode,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase8;		
DELIMITER //		
create procedure SummaryOutIntCase8(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_igwid  		
  group by CountryCode,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase9;		
DELIMITER //		
create procedure SummaryOutIntCase9(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by CountryCode,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase10;		
DELIMITER //		
create procedure SummaryOutIntCase10(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by CountryCode		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
where x.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCase11;		
DELIMITER //		
create procedure SummaryOutIntCase11(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by CountryCode,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
where x.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase12;		
DELIMITER //		
create procedure SummaryOutIntCase12(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by CountryCode,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
where x.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase13;		
DELIMITER //		
create procedure SummaryOutIntCase13(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by CountryCode,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
where x.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase14;		
DELIMITER //		
create procedure SummaryOutIntCase14(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by CountryCode,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
where x.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase15;		
DELIMITER //		
create procedure SummaryOutIntCase15(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by CountryCode,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
where x.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase16;		
DELIMITER //		
create procedure SummaryOutIntCase16(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by CountryCode,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
where x.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase17;		
DELIMITER //		
create procedure SummaryOutIntCase17(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_igwid  		
  group by CountryCode,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
where x.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase18;		
DELIMITER //		
create procedure SummaryOutIntCase18(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by CountryCode,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
where x.CountryCode=p_CountryCode		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCase19;		
DELIMITER //		
create procedure SummaryOutIntCase19(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by MatchedPrefixY		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase20;		
DELIMITER //		
create procedure SummaryOutIntCase20(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by MatchedPrefixY,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase21;		
DELIMITER //		
create procedure SummaryOutIntCase21(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by MatchedPrefixY,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase22;		
DELIMITER //		
create procedure SummaryOutIntCase22(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by MatchedPrefixY,customerid		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCase23;		
DELIMITER //		
create procedure SummaryOutIntCase23(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase24;		
DELIMITER //		
create procedure SummaryOutIntCase24(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId  		
  group by MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase25;		
DELIMITER //		
create procedure SummaryOutIntCase25(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by MatchedPrefixY,customerid		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCase26;		
DELIMITER //		
create procedure SummaryOutIntCase26(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId    		
  group by MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase27;		
DELIMITER //		
create procedure SummaryOutIntCase27(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCase28;		
DELIMITER //		
create procedure SummaryOutIntCase28(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase29;		
DELIMITER //		
create procedure SummaryOutIntCase29(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by MatchedPrefixY,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase30;		
DELIMITER //		
create procedure SummaryOutIntCase30(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase31;		
DELIMITER //		
create procedure SummaryOutIntCase31(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCase32;		
DELIMITER //		
create procedure SummaryOutIntCase32(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase33;		
DELIMITER //		
create procedure SummaryOutIntCase33(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase34;		
DELIMITER //		
create procedure SummaryOutIntCase34(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCase35;		
DELIMITER //		
create procedure SummaryOutIntCase35(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCase36;		
DELIMITER //		
create procedure SummaryOutIntCase36(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase1;		
DELIMITER //		
create procedure OutIntCarrierAllCase1(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),CountryCode	,supplierid	
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierAllCase2;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase2(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),CountryCode,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase3;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase3(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`),CountryCode,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase4;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase4(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),CountryCode,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase5;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase5(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase6;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase6(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase7;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase7(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by date(`Date`),CountryCode,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase8;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase8(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_igwid  		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase9;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase9(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase10;		
DELIMITER //		
create procedure OutIntCarrierAllCase10(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),CountryCode		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierAllCase11;		
DELIMITER //		
create procedure OutIntCarrierAllCase11(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),CountryCode,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase12;		
DELIMITER //		
create procedure OutIntCarrierAllCase12(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`),CountryCode,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase13;		
DELIMITER //		
create procedure OutIntCarrierAllCase13(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),CountryCode,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase14;		
DELIMITER //		
create procedure OutIntCarrierAllCase14(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase15;		
DELIMITER //		
create procedure OutIntCarrierAllCase15(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase16;		
DELIMITER //		
create procedure OutIntCarrierAllCase16(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by date(`Date`),CountryCode,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase17;		
DELIMITER //		
create procedure OutIntCarrierAllCase17(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_igwid  		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase18;		
DELIMITER //		
create procedure OutIntCarrierAllCase18(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierAllCase19;		
DELIMITER //		
create procedure OutIntCarrierAllCase19(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),MatchedPrefixY		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase20;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase20(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase21;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase21(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase22;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase22(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierAllCase23;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase23(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase24;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase24(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase25;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase25(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by date(`Date`),MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierAllCase26;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase26(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId    		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase27;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase27(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierAllCase28;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase28(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase29;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase29(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase30;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase30(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase31;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase31(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierAllCase32;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase32(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase33;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase33(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase34;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase34(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierAllCase35;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase35(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllCase36;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllCase36(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllOneCountryCase19;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllOneCountryCase19(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),MatchedPrefixY		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllOneCountryCase20;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllOneCountryCase20(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllOneCountryCase21;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllOneCountryCase21(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllOneCountryCase22;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllOneCountryCase22(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierAllOneCountryCase23;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllOneCountryCase23(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllOneCountryCase24;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllOneCountryCase24(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllOneCountryCase25;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllOneCountryCase25(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by date(`Date`),MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierAllOneCountryCase26;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllOneCountryCase26(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId    		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllOneCountryCase27;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllOneCountryCase27(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierAllOneCountryCase28;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllOneCountryCase28(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllOneCountryCase29;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllOneCountryCase29(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllOneCountryCase30;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllOneCountryCase30(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllOneCountryCase31;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllOneCountryCase31(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierAllOneCountryCase32;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllOneCountryCase32(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllOneCountryCase33;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllOneCountryCase33(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllOneCountryCase34;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllOneCountryCase34(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierAllOneCountryCase35;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllOneCountryCase35(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierAllOneCountryCase36;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierAllOneCountryCase36(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
		
		
drop procedure OutIntCarrierOneCase1;		
DELIMITER //		
create procedure OutIntCarrierOneCase1(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
	and supplierid=p_intlcarrier	
  group by date(`Date`),CountryCode	,supplierid	
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierOneCase2;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase2(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
	and supplierid=p_intlcarrier	
  group by date(`Date`),CountryCode,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase3;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase3(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by date(`Date`),CountryCode,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase4;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase4(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`),CountryCode,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase5;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase5(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase6;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase6(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase7;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase7(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId  		
  group by date(`Date`),CountryCode,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase8;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase8(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_igwid  		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase9;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase9(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase10;		
DELIMITER //		
create procedure OutIntCarrierOneCase10(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`),CountryCode,supplierid		
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierOneCase11;		
DELIMITER //		
create procedure OutIntCarrierOneCase11(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`),CountryCode,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase12;		
DELIMITER //		
create procedure OutIntCarrierOneCase12(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by date(`Date`),CountryCode,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase13;		
DELIMITER //		
create procedure OutIntCarrierOneCase13(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`),CountryCode,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase14;		
DELIMITER //		
create procedure OutIntCarrierOneCase14(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase15;		
DELIMITER //		
create procedure OutIntCarrierOneCase15(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase16;		
DELIMITER //		
create procedure OutIntCarrierOneCase16(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId  		
  group by date(`Date`),CountryCode,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase17;		
DELIMITER //		
create procedure OutIntCarrierOneCase17(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_igwid  		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase18;		
DELIMITER //		
create procedure OutIntCarrierOneCase18(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by date(`Date`),CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierOneCase19;		
DELIMITER //		
create procedure OutIntCarrierOneCase19(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`),MatchedPrefixY		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase20;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase20(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase21;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase21(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase22;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase22(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`),MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierOneCase23;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase23(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase24;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase24(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase25;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase25(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId  		
  group by date(`Date`),MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierOneCase26;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase26(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId    		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase27;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase27(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierOneCase28;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase28(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase29;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase29(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase30;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase30(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase31;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase31(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierOneCase32;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase32(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase33;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase33(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase34;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase34(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierOneCase35;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase35(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneCase36;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneCase36(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneOneCountryCase19;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneOneCountryCase19(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`),MatchedPrefixY		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneOneCountryCase20;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneOneCountryCase20(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneOneCountryCase21;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneOneCountryCase21(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneOneCountryCase22;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneOneCountryCase22(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`),MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierOneOneCountryCase23;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneOneCountryCase23(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneOneCountryCase24;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneOneCountryCase24(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneOneCountryCase25;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneOneCountryCase25(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId  		
  group by date(`Date`),MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierOneOneCountryCase26;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneOneCountryCase26(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId    		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneOneCountryCase27;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneOneCountryCase27(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierOneOneCountryCase28;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneOneCountryCase28(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneOneCountryCase29;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneOneCountryCase29(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneOneCountryCase30;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneOneCountryCase30(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneOneCountryCase31;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneOneCountryCase31(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierOneOneCountryCase32;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneOneCountryCase32(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneOneCountryCase33;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneOneCountryCase33(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneOneCountryCase34;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneOneCountryCase34(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutIntCarrierOneOneCountryCase35;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneOneCountryCase35(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutIntCarrierOneOneCountryCase36;		
DELIMITER //		
CREATE PROCEDURE OutIntCarrierOneOneCountryCase36(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by date(`Date`),MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase1;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase1(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by CountryCode	,supplierid	
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierAllCase2;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase2(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by CountryCode,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase3;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase3(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by CountryCode,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase4;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase4(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by CountryCode,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase5;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase5(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase6;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase6(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase7;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase7(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by CountryCode,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase8;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase8(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_igwid  		
  group by CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase9;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase9(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase10;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase10(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by CountryCode		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierAllCase11;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase11(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by CountryCode,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase12;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase12(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by CountryCode,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase13;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase13(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by CountryCode,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase14;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase14(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase15;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase15(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase16;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase16(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by CountryCode,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase17;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase17(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_igwid  		
  group by CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase18;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase18(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierAllCase19;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase19(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by MatchedPrefixY		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase20;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase20(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase21;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase21(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase22;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase22(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierAllCase23;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase23(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase24;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase24(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase25;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase25(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierAllCase26;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase26(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId    		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase27;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase27(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierAllCase28;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase28(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase29;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase29(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase30;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase30(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase31;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase31(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierAllCase32;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase32(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase33;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase33(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase34;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase34(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierAllCase35;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase35(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllCase36;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllCase36(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllOneCountryCase19;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllOneCountryCase19(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by MatchedPrefixY		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllOneCountryCase20;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllOneCountryCase20(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllOneCountryCase21;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllOneCountryCase21(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllOneCountryCase22;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllOneCountryCase22(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierAllOneCountryCase23;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllOneCountryCase23(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllOneCountryCase24;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllOneCountryCase24(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllOneCountryCase25;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllOneCountryCase25(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierAllOneCountryCase26;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllOneCountryCase26(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId    		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllOneCountryCase27;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllOneCountryCase27(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierAllOneCountryCase28;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllOneCountryCase28(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllOneCountryCase29;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllOneCountryCase29(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllOneCountryCase30;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllOneCountryCase30(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllOneCountryCase31;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllOneCountryCase31(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierAllOneCountryCase32;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllOneCountryCase32(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllOneCountryCase33;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllOneCountryCase33(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllOneCountryCase34;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllOneCountryCase34(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierAllOneCountryCase35;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllOneCountryCase35(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierAllOneCountryCase36;		
DELIMITER //		
create procedure SummaryOutIntCarrierAllOneCountryCase36(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
		
		
drop procedure SummaryOutIntCarrierOneCase1;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase1(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
	and supplierid=p_intlcarrier	
  group by CountryCode	,supplierid	
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierOneCase2;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase2(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
	and supplierid=p_intlcarrier	
  group by CountryCode,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase3;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase3(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by CountryCode,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase4;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase4(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by CountryCode,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase5;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase5(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase6;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase6(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase7;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase7(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId  		
  group by CountryCode,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase8;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase8(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_igwid  		
  group by CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase9;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase9(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase10;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase10(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by CountryCode		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierOneCase11;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase11(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by CountryCode,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase12;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase12(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by CountryCode,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase13;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase13(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by CountryCode,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase14;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase14(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase15;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase15(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase16;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase16(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId  		
  group by CountryCode,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase17;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase17(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_igwid  		
  group by CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase18;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase18(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select concat(cn.name,' (',x.CountryCode,')') as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,CountryCode,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by CountryCode,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CountryCode cn		
on x.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where x.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierOneCase19;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase19(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by MatchedPrefixY		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase20;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase20(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase21;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase21(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase22;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase22(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by MatchedPrefixY,customerid,supplierid		
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierOneCase23;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase23(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase24;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase24(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase25;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase25(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId  		
  group by MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierOneCase26;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase26(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId    		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase27;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase27(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierOneCase28;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase28(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase29;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase29(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase30;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase30(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase31;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase31(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierOneCase32;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase32(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase33;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase33(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase34;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase34(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierOneCase35;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase35(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneCase36;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneCase36(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneOneCountryCase19;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneOneCountryCase19(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by MatchedPrefixY		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneOneCountryCase20;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneOneCountryCase20(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneOneCountryCase21;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneOneCountryCase21(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneOneCountryCase22;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneOneCountryCase22(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierOneOneCountryCase23;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneOneCountryCase23(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneOneCountryCase24;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneOneCountryCase24(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneOneCountryCase25;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneOneCountryCase25(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId  		
  group by MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierOneOneCountryCase26;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneOneCountryCase26(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId    		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneOneCountryCase27;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneOneCountryCase27(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierOneOneCountryCase28;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneOneCountryCase28(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneOneCountryCase29;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneOneCountryCase29(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneOneCountryCase30;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneOneCountryCase30(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneOneCountryCase31;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneOneCountryCase31(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierOneOneCountryCase32;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneOneCountryCase32(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and MatchedPrefixY=p_MatchedPrefixY    		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneOneCountryCase33;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneOneCountryCase33(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneOneCountryCase34;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneOneCountryCase34(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutIntCarrierOneOneCountryCase35;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneOneCountryCase35(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutIntCarrierOneOneCountryCase36;		
DELIMITER //		
create procedure SummaryOutIntCarrierOneOneCountryCase36(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select concat(cn.name,' (',cx.CountryCode,')') as Country,concat(x.MatchedPrefixY,' (',cx.Description,')') AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid,MatchedPrefixY,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  and MatchedPrefixY=p_MatchedPrefixY  		
  group by MatchedPrefixY,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
left join CustomerRateICX cx		
on x.MatchedPrefixY=cx.Prefix		
left join CountryCode cn		
on cx.CountryCode=cn.Code		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
where cx.CountryCode=p_CountryCode		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
