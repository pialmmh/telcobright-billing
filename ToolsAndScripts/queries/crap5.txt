drop procedure OutNoDestIntCase1;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase1(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date` ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) 		
having sum(chargingstatus)>0  ) x		
		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCase2;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase2(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date` ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase3;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase3(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date` ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`) ,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase4;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase4(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase5;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase5(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase6;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase6(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`) ,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase7;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase7(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by date(`Date`) ,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase8;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase8(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_igwid  		
  group by date(`Date`) ,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase9;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase9(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by date(`Date`) ,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase10;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase10(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date` ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) 		
having sum(chargingstatus)>0  ) x		
		
		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCase11;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase11(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date` ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase12;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase12(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date` ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`) ,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase13;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase13(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase14;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase14(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase15;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase15(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`) ,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase16;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase16(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by date(`Date`) ,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase17;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase17(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_igwid  		
  group by date(`Date`) ,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase18;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase18(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by date(`Date`) ,AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCase19;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase19(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) 		
having sum(chargingstatus)>0  ) x		
		
		
		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase20;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase20(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase21;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase21(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`) ,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase22;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase22(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,customerid		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCase23;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase23(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase24;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase24(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId  		
  group by date(`Date`) ,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase25;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase25(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by date(`Date`) ,customerid		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCase26;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase26(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId    		
  group by date(`Date`) ,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase27;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase27(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by date(`Date`) ,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCase28;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase28(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
    		
  group by date(`Date`) 		
having sum(chargingstatus)>0  ) x		
		
		
		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase29;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase29(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
      		
  group by date(`Date`) ,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase30;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase30(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
    		
  group by date(`Date`) ,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase31;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase31(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
    		
  group by date(`Date`) ,customerid		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCase32;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase32(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
      		
  group by date(`Date`) ,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase33;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase33(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
    		
  group by date(`Date`) ,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase34;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase34(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
    		
  group by date(`Date`) ,customerid		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCase35;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase35(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
    		
  group by date(`Date`) ,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCase36;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCase36(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
    		
  group by date(`Date`) ,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntOneCountryCase19;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntOneCountryCase19(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) 		
having sum(chargingstatus)>0  ) x		
		
		
		
		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntOneCountryCase20;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntOneCountryCase20(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntOneCountryCase21;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntOneCountryCase21(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`) ,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntOneCountryCase22;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntOneCountryCase22(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,customerid		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntOneCountryCase23;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntOneCountryCase23(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntOneCountryCase24;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntOneCountryCase24(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId  		
  group by date(`Date`) ,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntOneCountryCase25;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntOneCountryCase25(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by date(`Date`) ,customerid		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntOneCountryCase26;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntOneCountryCase26(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId    		
  group by date(`Date`) ,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntOneCountryCase27;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntOneCountryCase27(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by date(`Date`) ,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntOneCountryCase28;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntOneCountryCase28(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
    		
  group by date(`Date`) 		
having sum(chargingstatus)>0  ) x		
		
		
		
		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntOneCountryCase29;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntOneCountryCase29(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
      		
  group by date(`Date`) ,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntOneCountryCase30;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntOneCountryCase30(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
    		
  group by date(`Date`) ,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntOneCountryCase31;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntOneCountryCase31(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
    		
  group by date(`Date`) ,customerid		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntOneCountryCase32;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntOneCountryCase32(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
      		
  group by date(`Date`) ,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntOneCountryCase33;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntOneCountryCase33(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
    		
  group by date(`Date`) ,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntOneCountryCase34;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntOneCountryCase34(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
    		
  group by date(`Date`) ,customerid		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntOneCountryCase35;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntOneCountryCase35(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
    		
  group by date(`Date`) ,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntOneCountryCase36;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntOneCountryCase36(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
    		
  group by date(`Date`) ,customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntOneCountryCase19;		
DELIMITER //		
CREATE PROCEDURE SummaryOutNoDestIntOneCountryCase19(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  
having sum(chargingstatus)>0  ) x		
		
		
		
		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntOneCountryCase20;		
DELIMITER //		
CREATE PROCEDURE SummaryOutNoDestIntOneCountryCase20(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntOneCountryCase21;		
DELIMITER //		
CREATE PROCEDURE SummaryOutNoDestIntOneCountryCase21(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntOneCountryCase22;		
DELIMITER //		
CREATE PROCEDURE SummaryOutNoDestIntOneCountryCase22(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by customerid		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntOneCountryCase23;		
DELIMITER //		
CREATE PROCEDURE SummaryOutNoDestIntOneCountryCase23(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntOneCountryCase24;		
DELIMITER //		
CREATE PROCEDURE SummaryOutNoDestIntOneCountryCase24(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId  		
  group by customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntOneCountryCase25;		
DELIMITER //		
CREATE PROCEDURE SummaryOutNoDestIntOneCountryCase25(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by customerid		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntOneCountryCase26;		
DELIMITER //		
CREATE PROCEDURE SummaryOutNoDestIntOneCountryCase26(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId    		
  group by customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntOneCountryCase27;		
DELIMITER //		
CREATE PROCEDURE SummaryOutNoDestIntOneCountryCase27(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntOneCountryCase28;		
DELIMITER //		
CREATE PROCEDURE SummaryOutNoDestIntOneCountryCase28(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
    		
  
having sum(chargingstatus)>0  ) x		
		
		
		
		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntOneCountryCase29;		
DELIMITER //		
CREATE PROCEDURE SummaryOutNoDestIntOneCountryCase29(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
      		
  group by AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntOneCountryCase30;		
DELIMITER //		
CREATE PROCEDURE SummaryOutNoDestIntOneCountryCase30(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
    		
  group by AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntOneCountryCase31;		
DELIMITER //		
CREATE PROCEDURE SummaryOutNoDestIntOneCountryCase31(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
    		
  group by customerid		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntOneCountryCase32;		
DELIMITER //		
CREATE PROCEDURE SummaryOutNoDestIntOneCountryCase32(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
      		
  group by customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntOneCountryCase33;		
DELIMITER //		
CREATE PROCEDURE SummaryOutNoDestIntOneCountryCase33(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
    		
  group by customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntOneCountryCase34;		
DELIMITER //		
CREATE PROCEDURE SummaryOutNoDestIntOneCountryCase34(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
    		
  group by customerid		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntOneCountryCase35;		
DELIMITER //		
CREATE PROCEDURE SummaryOutNoDestIntOneCountryCase35(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
    		
  group by customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntOneCountryCase36;		
DELIMITER //		
CREATE PROCEDURE SummaryOutNoDestIntOneCountryCase36(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
    		
  group by customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
		
drop procedure SummaryOutNoDestIntCase1;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase1(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  		
having sum(chargingstatus)>0  ) x		
		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCase2;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase2(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase3;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase3(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase4;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase4(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase5;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase5(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase6;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase6(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase7;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase7(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase8;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase8(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_igwid  		
  group by AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase9;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase9(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase10;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase10(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  		
having sum(chargingstatus)>0  ) x		
		
		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCase11;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase11(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase12;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase12(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase13;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase13(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase14;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase14(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase15;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase15(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase16;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase16(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase17;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase17(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_igwid  		
  group by AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase18;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase18(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by AnsIdOrig,customerid		
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCase19;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase19(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  
having sum(chargingstatus)>0  ) x		
		
		
		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase20;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase20(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase21;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase21(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase22;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase22(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by customerid		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCase23;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase23(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase24;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase24(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId  		
  group by customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase25;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase25(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by customerid		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCase26;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase26(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId    		
  group by customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase27;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase27(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCase28;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase28(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
    		
  
having sum(chargingstatus)>0  ) x		
		
		
		
		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase29;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase29(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
      		
  group by AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase30;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase30(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
    		
  group by AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase31;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase31(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
    		
  group by customerid		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCase32;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase32(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
      		
  group by customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase33;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase33(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
    		
  group by customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase34;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase34(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
    		
  group by customerid		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCase35;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase35(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
    		
  group by customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCase36;		
DELIMITER //		
create procedure SummaryOutNoDestIntCase36(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', (select null) as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
    		
  group by customerid,AnsIdOrig		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
order by  `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase1;		
DELIMITER //		
create procedure OutNoDestIntCarrierAllCase1(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date` ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) 	,supplierid	
having sum(chargingstatus)>0  ) x		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierAllCase2;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase2(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date` ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase3;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase3(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date` ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase4;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase4(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase5;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase5(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase6;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase6(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`) ,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase7;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase7(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase8;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase8(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_igwid  		
  group by date(`Date`) ,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase9;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase9(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by date(`Date`) ,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase10;		
DELIMITER //		
create procedure OutNoDestIntCarrierAllCase10(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date` ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) 		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierAllCase11;		
DELIMITER //		
create procedure OutNoDestIntCarrierAllCase11(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date` ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase12;		
DELIMITER //		
create procedure OutNoDestIntCarrierAllCase12(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date` ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase13;		
DELIMITER //		
create procedure OutNoDestIntCarrierAllCase13(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase14;		
DELIMITER //		
create procedure OutNoDestIntCarrierAllCase14(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase15;		
DELIMITER //		
create procedure OutNoDestIntCarrierAllCase15(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`) ,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase16;		
DELIMITER //		
create procedure OutNoDestIntCarrierAllCase16(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase17;		
DELIMITER //		
create procedure OutNoDestIntCarrierAllCase17(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_igwid  		
  group by date(`Date`) ,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase18;		
DELIMITER //		
create procedure OutNoDestIntCarrierAllCase18(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by date(`Date`) ,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierAllCase19;		
DELIMITER //		
create procedure OutNoDestIntCarrierAllCase19(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) 		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase20;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase20(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase21;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase21(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase22;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase22(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierAllCase23;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase23(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase24;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase24(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId  		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase25;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase25(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierAllCase26;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase26(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId    		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase27;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase27(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierAllCase28;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase28(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
    		
  group by date(`Date`) 		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase29;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase29(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
      		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase30;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase30(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
    		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase31;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase31(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
    		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierAllCase32;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase32(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
      		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase33;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase33(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
    		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase34;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase34(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
    		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierAllCase35;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase35(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
    		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllCase36;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllCase36(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
    		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllOneCountryCase19;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllOneCountryCase19(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) 		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllOneCountryCase20;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllOneCountryCase20(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllOneCountryCase21;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllOneCountryCase21(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllOneCountryCase22;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllOneCountryCase22(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierAllOneCountryCase23;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllOneCountryCase23(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllOneCountryCase24;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllOneCountryCase24(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId  		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllOneCountryCase25;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllOneCountryCase25(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierAllOneCountryCase26;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllOneCountryCase26(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId    		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllOneCountryCase27;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllOneCountryCase27(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierAllOneCountryCase28;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllOneCountryCase28(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
    		
  group by date(`Date`) 		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllOneCountryCase29;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllOneCountryCase29(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
      		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllOneCountryCase30;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllOneCountryCase30(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
    		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllOneCountryCase31;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllOneCountryCase31(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
    		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierAllOneCountryCase32;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllOneCountryCase32(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
      		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllOneCountryCase33;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllOneCountryCase33(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
    		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllOneCountryCase34;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllOneCountryCase34(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
    		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierAllOneCountryCase35;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllOneCountryCase35(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
    		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierAllOneCountryCase36;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierAllOneCountryCase36(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
    		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
		
		
drop procedure OutNoDestIntCarrierOneCase1;		
DELIMITER //		
create procedure OutNoDestIntCarrierOneCase1(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date` ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
	and supplierid=p_intlcarrier	
  group by date(`Date`) 	,supplierid	
having sum(chargingstatus)>0  ) x		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierOneCase2;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase2(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date` ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
	and supplierid=p_intlcarrier	
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase3;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase3(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date` ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase4;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase4(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase5;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase5(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`) ,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase6;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase6(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by date(`Date`) ,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase7;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase7(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId  		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase8;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase8(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_igwid  		
  group by date(`Date`) ,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase9;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase9(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by date(`Date`) ,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase10;		
DELIMITER //		
create procedure OutNoDestIntCarrierOneCase10(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date` ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`) ,supplierid		
having sum(chargingstatus)>0  ) x		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierOneCase11;		
DELIMITER //		
create procedure OutNoDestIntCarrierOneCase11(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date` ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase12;		
DELIMITER //		
create procedure OutNoDestIntCarrierOneCase12(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date` ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase13;		
DELIMITER //		
create procedure OutNoDestIntCarrierOneCase13(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase14;		
DELIMITER //		
create procedure OutNoDestIntCarrierOneCase14(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`) ,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase15;		
DELIMITER //		
create procedure OutNoDestIntCarrierOneCase15(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by date(`Date`) ,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase16;		
DELIMITER //		
create procedure OutNoDestIntCarrierOneCase16(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId  		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase17;		
DELIMITER //		
create procedure OutNoDestIntCarrierOneCase17(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_igwid  		
  group by date(`Date`) ,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase18;		
DELIMITER //		
create procedure OutNoDestIntCarrierOneCase18(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by date(`Date`) ,AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierOneCase19;		
DELIMITER //		
create procedure OutNoDestIntCarrierOneCase19(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`) 		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase20;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase20(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase21;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase21(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase22;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase22(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierOneCase23;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase23(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase24;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase24(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId  		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase25;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase25(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId  		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierOneCase26;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase26(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId    		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase27;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase27(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierOneCase28;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase28(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
    		
  group by date(`Date`) 		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase29;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase29(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
      		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase30;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase30(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
    		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase31;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase31(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
    		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierOneCase32;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase32(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
      		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase33;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase33(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
    		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase34;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase34(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId		
    		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierOneCase35;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase35(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId		
    		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneCase36;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneCase36(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
    		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneOneCountryCase19;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneOneCountryCase19(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`) 		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneOneCountryCase20;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneOneCountryCase20(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneOneCountryCase21;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneOneCountryCase21(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneOneCountryCase22;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneOneCountryCase22(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierOneOneCountryCase23;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneOneCountryCase23(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneOneCountryCase24;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneOneCountryCase24(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId  		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneOneCountryCase25;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneOneCountryCase25(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId  		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierOneOneCountryCase26;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneOneCountryCase26(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId    		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneOneCountryCase27;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneOneCountryCase27(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierOneOneCountryCase28;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneOneCountryCase28(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
    		
  group by date(`Date`) 		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneOneCountryCase29;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneOneCountryCase29(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
      		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneOneCountryCase30;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneOneCountryCase30(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
    		
  group by date(`Date`) ,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneOneCountryCase31;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneOneCountryCase31(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
    		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierOneOneCountryCase32;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneOneCountryCase32(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
      		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneOneCountryCase33;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneOneCountryCase33(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
    		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneOneCountryCase34;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneOneCountryCase34(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId		
    		
  group by date(`Date`) ,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure OutNoDestIntCarrierOneOneCountryCase35;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneOneCountryCase35(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId		
    		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure OutNoDestIntCarrierOneOneCountryCase36;		
DELIMITER //		
CREATE PROCEDURE OutNoDestIntCarrierOneOneCountryCase36(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select DATE_FORMAT(`Date`,'%d/%m/%Y') as `Date`,(select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select date(StartTime)as `Date`,AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
    		
  group by date(`Date`) ,customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by date asc, `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase1;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase1(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by supplierid	
having sum(chargingstatus)>0  ) x		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierAllCase2;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase2(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase3;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase3(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase4;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase4(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase5;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase5(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase6;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase6(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase7;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase7(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase8;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase8(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_igwid  		
  group by AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase9;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase9(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase10;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase10(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierAllCase11;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase11(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase12;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase12(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase13;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase13(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase14;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase14(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase15;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase15(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase16;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase16(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase17;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase17(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_igwid  		
  group by AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase18;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase18(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierAllCase19;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase19(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase20;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase20(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase21;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase21(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase22;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase22(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierAllCase23;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase23(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase24;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase24(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId  		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase25;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase25(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierAllCase26;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase26(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId    		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase27;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase27(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierAllCase28;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase28(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
    		
  group by supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase29;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase29(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
      		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase30;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase30(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
    		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase31;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase31(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
    		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierAllCase32;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase32(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
      		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase33;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase33(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
    		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase34;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase34(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
    		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierAllCase35;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase35(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
    		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllCase36;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllCase36(IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
    		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllOneCountryCase19;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllOneCountryCase19(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllOneCountryCase20;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllOneCountryCase20(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllOneCountryCase21;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllOneCountryCase21(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllOneCountryCase22;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllOneCountryCase22(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierAllOneCountryCase23;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllOneCountryCase23(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllOneCountryCase24;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllOneCountryCase24(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId  		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllOneCountryCase25;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllOneCountryCase25(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId  		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierAllOneCountryCase26;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllOneCountryCase26(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId    		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllOneCountryCase27;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllOneCountryCase27(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierAllOneCountryCase28;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllOneCountryCase28(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
    		
  group by supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllOneCountryCase29;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllOneCountryCase29(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
      		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllOneCountryCase30;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllOneCountryCase30(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
    		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllOneCountryCase31;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllOneCountryCase31(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
    		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierAllOneCountryCase32;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllOneCountryCase32(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
      		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllOneCountryCase33;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllOneCountryCase33(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
    		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllOneCountryCase34;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllOneCountryCase34(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
    		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierAllOneCountryCase35;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllOneCountryCase35(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and customerid=p_IgwId		
    		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierAllOneCountryCase36;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierAllOneCountryCase36(IN p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
    		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase1;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase1(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
	and supplierid=p_intlcarrier	
  group by supplierid	
having sum(chargingstatus)>0  ) x		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierOneCase2;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase2(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
	and supplierid=p_intlcarrier	
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase3;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase3(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase4;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase4(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase5;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase5(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase6;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase6(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase7;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase7(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId  		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase8;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase8(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_igwid  		
  group by AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase9;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase9(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase10;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase10(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierOneCase11;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase11(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase12;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase12(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase13;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase13(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase14;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase14(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase15;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase15(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase16;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase16(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId  		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase17;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase17(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
        round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_igwid  		
  group by AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase18;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase18(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),		
IN p_AnsId int,IN p_IgwId int,IN p_CountryCode varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
select (select NULL)  as Country,(SELECT NULL) AS Destination,cr.CarrierName AS ANS,ig.carriername AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,AnsIdOrig,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
  round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
  group by AnsIdOrig,customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join Carrier ig		
on x.customerid=ig.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierOneCase19;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase19(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase20;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase20(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase21;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase21(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase22;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase22(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by customerid,supplierid		
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierOneCase23;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase23(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase24;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase24(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId  		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase25;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase25(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId  		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierOneCase26;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase26(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId    		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase27;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase27(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierOneCase28;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase28(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
    		
  group by supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase29;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase29(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
      		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase30;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase30(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
    		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase31;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase31(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
    		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierOneCase32;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase32(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
      		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase33;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase33(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
    		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase34;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase34(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId		
    		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierOneCase35;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase35(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId		
    		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneCase36;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneCase36(IN p_IntlCarrier int,  p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
    		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneOneCountryCase19;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneOneCountryCase19(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneOneCountryCase20;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneOneCountryCase20(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneOneCountryCase21;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneOneCountryCase21(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneOneCountryCase22;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneOneCountryCase22(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierOneOneCountryCase23;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneOneCountryCase23(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneOneCountryCase24;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneOneCountryCase24(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId  		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneOneCountryCase25;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneOneCountryCase25(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId  		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierOneOneCountryCase26;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneOneCountryCase26(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId    		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneOneCountryCase27;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneOneCountryCase27(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int)		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId  		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierOneOneCountryCase28;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneOneCountryCase28(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
    		
  group by supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneOneCountryCase29;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneOneCountryCase29(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
      		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneOneCountryCase30;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneOneCountryCase30(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,cr.CarrierName AS ANS,(SELECT NULL) AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
    		
  group by AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.AnsIdOrig=cr.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneOneCountryCase31;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneOneCountryCase31(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
    		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierOneOneCountryCase32;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneOneCountryCase32(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
      		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneOneCountryCase33;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneOneCountryCase33(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
    		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneOneCountryCase34;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneOneCountryCase34(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,(SELECT NULL) AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId		
    		
  group by customerid		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
drop procedure SummaryOutNoDestIntCarrierOneOneCountryCase35;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneOneCountryCase35(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and customerid=p_IgwId		
    		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
		
		
drop procedure SummaryOutNoDestIntCarrierOneOneCountryCase36;		
DELIMITER //		
create procedure SummaryOutNoDestIntCarrierOneOneCountryCase36(IN p_IntlCarrier int,  p_CountryCode varchar(45),IN p_UsdRateY float,IN p_StartDateTime varchar(45), IN p_EndDateTime varchar(45),IN p_AnsId int,IN p_IgwId int,IN p_MatchedPrefixY varchar(45))		
BEGIN		
		
declare varStartDate varchar(45);		
declare varEndDate varchar(45);		
		
IF LENGTH(p_StartDateTime)=19 THEN		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' ',		
                        substring(p_StartDateTime,12,8));		
ELSE		
set varStartDate=concat(substring(p_StartDateTime,7,4),'-',		
                        substring(p_StartDateTime,4,2),'-',		
                        substring(p_StartDateTime,1,2),' 00:00:00');		
		
END IF;		
		
IF LENGTH(p_EndDateTime)=19 THEN		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' ',		
                        substring(p_EndDateTime,12,8));		
ELSE		
set varEndDate=concat(substring(p_EndDateTime,7,4),'-',		
                        substring(p_EndDateTime,4,2),'-',		
                        substring(p_EndDateTime,1,2),' 23:59:59');		
		
END IF;		
		
		
		
select (select NULL) as Country,(select NULL) AS Destination,crAns.CarrierName AS ANS,cr.CarrierName AS IGW,		
Callsout as 'No of Calls (Outgoing International)',MinutesOut as 'Paid Minutes (Outgoing Internaitonal)',		
Xbdt as 'X (BDT)',YUsd as 'Y (USD)',round(Zbdt,6) as 'Z (BDT)', crintl.CarrierName as 'International Carrier',revenueigwout,suppliercost,profitbdt, profitminute,roundedduration,asr,acd,pdd,ccr,CallsCount,ConnectedCount 		
from		
	(select AnsIdOrig,customerid ,sum(chargingstatus) as Callsout, round(sum(round(durationsec))/60,6) as MinutesOut,	
    round(sum(SubscriberchargeXOut),6) as Xbdt,round(sum(CarrierCostYIgwOut),6) as Yusd,		
  sum(SubscriberchargeXOut)-(sum(CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY))) as Zbdt		
	, Supplierid , ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,p_UsdRateY)))  )/100 as revenueigwout,sum(suppliercost) as suppliercost,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4))) as profitbdt,(( ( sum(revenueigwout*SubscriberchargeXOut)-(sum(revenueigwout*CarrierCostYIgwOut*ifnull(u.rateamount,78.4)))  )/100) + sum(CarrierCostYIgwOut*ifnull(u.rateamount,78.4)) -sum(suppliercost*ifnull(u.rateamount,78.4)))/(sum(round(durationsec,0))/60) as profitminute	
, round(sum(roundedduration)/60,6) as roundedduration ,(sum(chargingstatus)/count(*))*100 as ASR, ((sum(round(durationsec,0))/60)/sum(chargingstatus)) as ACD,avg(pdd) as PDD , 100*count(connecttime)/count(*) as CCR,  count(*) as CallsCount,count(connecttime) as ConnectedCount 		
from cdrloaded		
 c left join usdexchangerateagainstbdt u on c.field1=u.field1 and c.field2=u.field2		
	where starttime>=varStartDate	
	and starttime<=varEndDate	
		
	and calldirection=2	
  and supplierid=p_intlcarrier		
  and AnsIdOrig=p_AnsId		
  and customerid=p_IgwId		
    		
  group by customerid,AnsIdOrig		,supplierid
having sum(chargingstatus)>0  ) x		
		
		
		
		
left join Carrier cr		
on x.customerid=cr.idcarrier		
left join Carrier crAns		
on x.AnsIdOrig=crAns.idCarrier		
left join carrier crintl		
on x.supplierid=crintl.idcarrier		
		
order by `Paid Minutes (Outgoing Internaitonal)` desc,IGW asc,ANS asc;		
		
END //		
DELIMITER ;		
